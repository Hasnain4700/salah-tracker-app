<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Salah Tracker</title>
  <link rel="stylesheet" href="style.css?v=3.5">
  <link rel="icon" href="icon-192.png" type="image/png">
  <link rel="apple-touch-icon" href="icon-192.png">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics.js";
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
    import { getDatabase, ref, set, get, onValue, update, runTransaction, push, query, limitToLast, orderByKey } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";
    window.FirebaseExports = {
      initializeApp, getAnalytics, getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut,
      getDatabase, ref, set, get, onValue, update, runTransaction, push, query, limitToLast, orderByKey
    };
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jsrsasign/10.6.1/jsrsasign-all-min.js"></script>

</head>

<body>
  <button id="settings-btn"
    style="position:fixed;top:18px;right:18px;z-index:1001;display:none;background:rgba(30, 41, 59, 0.8);backdrop-filter:blur(10px);color:#6ee7b7;border:1px solid rgba(110, 231, 183, 0.2);border-radius:50%;width:44px;height:44px;display:flex;align-items:center;justify-content:center;font-size:1.4em;box-shadow:0 4px 12px rgba(0,0,0,0.2);cursor:pointer;transition:transform 0.2s;">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
      stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="3"></circle>
      <path
        d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
      </path>
    </svg>
  </button>

  <!-- Settings Modal -->
  <div id="settings-modal" class="modal">
    <div class="modal-content" style="max-width: 400px; padding: 25px; text-align: left;">
      <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 style="margin:0; font-size: 1.5em; color: #fff;">Settings</h2>
        <button id="close-settings"
          style="background:none; border:none; color:#94a3b8; font-size:1.5em; cursor:pointer;">&times;</button>
      </div>

      <div style="max-height: 70vh; overflow-y: auto; padding-right: 5px;" class="custom-scroll">
        <!-- Account Section -->
        <div style="margin-bottom: 25px;">
          <h3
            style="font-size: 0.9em; color: #6ee7b7; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px;">
            Account</h3>
          <div class="setting-item">
            <label class="onboarding-label">Display Name</label>
            <input type="text" id="settings-display-name" class="onboarding-select" placeholder="Enter your name">
          </div>
        </div>

        <!-- Prayer Times Section -->
        <div style="margin-bottom: 25px;">
          <h3
            style="font-size: 0.9em; color: #6ee7b7; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px;">
            Custom Prayer Times</h3>
          <p style="font-size: 0.8em; color: #94a3b8; margin-bottom: 10px;">Adjust prayer times by minutes (+/-)</p>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div class="setting-item">
              <label class="onboarding-label">Fajr</label>
              <input type="number" id="offset-Fajr" class="onboarding-select" value="0">
            </div>
            <div class="setting-item">
              <label class="onboarding-label">Dhuhr</label>
              <input type="number" id="offset-Dhuhr" class="onboarding-select" value="0">
            </div>
            <div class="setting-item">
              <label class="onboarding-label">Asr</label>
              <input type="number" id="offset-Asr" class="onboarding-select" value="0">
            </div>
            <div class="setting-item">
              <label class="onboarding-label">Maghrib</label>
              <input type="number" id="offset-Maghrib" class="onboarding-select" value="0">
            </div>
            <div class="setting-item">
              <label class="onboarding-label">Isha</label>
              <input type="number" id="offset-Isha" class="onboarding-select" value="0">
            </div>
          </div>
        </div>

        <!-- App Preferences -->
        <div style="margin-bottom: 25px;">
          <h3
            style="font-size: 0.9em; color: #6ee7b7; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px;">
            Preferences</h3>
          <div class="setting-item" style="margin-bottom: 15px;">
            <label class="onboarding-label">Sleep Time</label>
            <input type="time" id="settings-sleep-time" class="onboarding-time">
          </div>
          <div class="setting-item">
            <label class="onboarding-label">Struggle Prayer</label>
            <select id="settings-struggle-prayer" class="onboarding-select">
              <option value="Fajr">Fajr</option>
              <option value="Dhuhr">Dhuhr</option>
              <option value="Asr">Asr</option>
              <option value="Maghrib">Maghrib</option>
              <option value="Isha">Isha</option>
            </select>
          </div>
        </div>

        <button id="save-settings-btn" class="onboarding-btn" style="width: 100%; margin-top: 10px;">Save
          Settings</button>

        <!-- Scalability & Community Extras -->
        <div style="margin-top: 25px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.05);">
          <div style="display: flex; gap: 10px; margin-bottom: 12px; margin-top: 20px;">
            <button id="export-data-btn"
              style="flex:1; background:rgba(110, 231, 183, 0.1); border:1px solid rgba(110, 231, 183, 0.3); color:#6ee7b7; padding:10px; border-radius:10px; font-size:0.85em; cursor:pointer;">ğŸ“¥
              Export Logs</button>
            <button id="send-feedback-btn"
              style="flex:1; background:rgba(251, 191, 36, 0.1); border:1px solid rgba(251, 191, 36, 0.3); color:#fbbf24; padding:10px; border-radius:10px; font-size:0.85em; cursor:pointer;">ğŸ’¬
              Feedback</button>
          </div>
          <div style="text-align: center; color: #475569; font-size: 0.75em; letter-spacing: 0.5px;">
            Salah Tracker v1.2.0 â€¢ Made with ğŸ’š
          </div>
        </div>

        <button id="settings-logout-btn"
          style="width: 100%; margin-top: 20px; background: none; border: 1px solid #ff6b6b; color: #ff6b6b; padding: 12px; border-radius: 12px; font-weight: 600; cursor: pointer;">Logout</button>
      </div>
    </div>
  </div>

  <!-- What's New Modal -->
  <div id="news-modal" class="modal">
    <div class="modal-content" style="max-width: 400px; padding: 30px;">
      <div style="font-size: 3.5em; margin-bottom: 15px;">âœ¨</div>
      <h2 style="margin:0 0 10px 0; color:#fff; font-size: 1.6em;">What's New!</h2>
      <div id="news-content"
        style="text-align: left; color: #94a3b8; font-size: 1em; line-height: 1.6; margin-bottom: 25px;">
        <!-- Content will be injected -->
      </div>
      <button id="close-news-btn" class="onboarding-btn" style="width: 100%;">MashaAllah, Got it!</button>
    </div>
  </div>
  <div class="container" id="home-section">
    <!-- Date Section -->
    <div class="date-section card">
      <button class="calendar-arrow" id="prev-date">&#8592;</button>
      <div class="dates">
        <div class="gregorian-date" id="gregorian-date">Monday, 1 Jan 2024</div>
        <div class="hijri-date" id="hijri-date">19 Jumada II 1445</div>
      </div>
      <button class="calendar-arrow" id="next-date">&#8594;</button>
    </div>

    <!-- Partner Status Widget (Deen Twins) -->
    <div id="home-partner-widget" class="card"
      style="display:none;background:linear-gradient(135deg, #1e293b, #0f172a);border-left:4px solid #6ee7b7;cursor:pointer;margin-bottom:12px;"
      onclick="navBtns[4].click(); setTimeout(()=>{openSubFeature('twins')}, 100);">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <div style="display:flex;align-items:center;gap:10px;">
          <div id="hp-avatar" style="font-size:1.5em;">ğŸ‘¤</div>
          <div style="text-align:left;">
            <div id="hp-name" style="font-weight:600;font-size:0.95em;color:#fff;">Partner</div>
            <div id="hp-status" style="font-size:0.8em;color:#94a3b8;">Waiting...</div>
          </div>
        </div>
        <div style="font-size:1.2em;color:#6ee7b7;">ğŸ¤</div>
      </div>
    </div>

    <!-- Streak Widget (New) -->
    <div id="home-streak-widget" class="card"
      style="display:none;background:linear-gradient(135deg, #b45309, #78350f);border:none;position:relative;overflow:hidden;cursor:pointer;margin-bottom:12px;box-shadow:0 4px 15px rgba(245, 158, 11, 0.3);"
      onclick="navBtns[3].click()">
      <div style="position:absolute;top:-20px;right:-20px;font-size:6em;opacity:0.1;transform:rotate(-15deg);">ğŸ”¥</div>
      <div style="display:flex;justify-content:space-between;align-items:center;position:relative;z-index:2;">
        <div style="display:flex;align-items:center;gap:12px;">
          <div class="fire-anim-container">
            <div class="fire-core">ğŸ”¥</div>
          </div>
          <div style="text-align:left;">
            <div style="font-weight:700;font-size:1.1em;color:#fff;">Salah Streak</div>
            <div style="font-size:0.85em;color:rgba(255,255,255,0.8);">Consistency is key! ğŸ”‘</div>
          </div>
        </div>
        <div style="font-size:1.5em;font-weight:800;color:#fff;text-shadow:0 2px 4px rgba(0,0,0,0.3);">
          <span id="home-streak-value">0</span> Days
        </div>
      </div>
    </div>

    <!-- Countdown Timer -->
    <div class="countdown-section card">
      <svg class="countdown-svg" width="120" height="120">
        <circle class="countdown-bg" cx="60" cy="60" r="54" />
        <circle class="countdown-progress" cx="60" cy="60" r="54" />
      </svg>
      <div class="countdown-label">
        <span id="next-prayer-name">Fajr</span>
        <span id="countdown-timer">01:23:45</span>
      </div>
      <button id="mark-prayer-btn" style="display:none;margin-top:12px;" class="thirty-day-btn">Mark as Prayed</button>
      <button id="mark-missed-btn" style="display:none;margin-top:12px;margin-left:8px;background:#ff6b6b;color:#fff;"
        class="thirty-day-btn">Mark as Missed</button>
      <div id="prayer-status-label" style="margin-top:10px;font-weight:600;font-size:1.1em;"></div>
      <div id="live-prayer-count-widget"
        style="margin-top:16px; background:#1e293b; padding:8px 16px; border-radius:20px; display:inline-flex; align-items:center; gap:8px; border:1px solid #334155; box-shadow:0 4px 12px #0003;">
        <div style="width:8px; height:8px; background:#22c55e; border-radius:50%; box-shadow:0 0 8px #22c55e;"></div>
        <span id="live-count-text" style="color:#e2e8f0; font-size:0.9em; font-weight:500;">Live: <span
            id="current-prayer-name-display" style="color:#6ee7b7; font-weight:600;">--</span> users <span
            id="current-prayer-count" style="color:#fcd34d; font-weight:700; font-size:1.1em;">0</span></span>
      </div>
    </div>

    <!-- Prayer Times List -->
    <div class="prayer-list card">
      <div class="prayer-item active">
        <span class="prayer-name">Tahajjud</span>
        <span class="prayer-time">02:30</span>
        <button class="bell-btn" title="Toggle notification">
          <span class="bell-icon">ğŸ””</span>
        </button>

      </div>
      <div class="prayer-item">
        <span class="prayer-name">Fajr</span>
        <span class="prayer-time">05:12</span>
        <button class="bell-btn" title="Toggle notification">
          <span class="bell-icon">ğŸ””</span>
        </button>

      </div>
      <div class="prayer-item">
        <span class="prayer-name">Dhuhr</span>
        <span class="prayer-time">12:45</span>
        <button class="bell-btn" title="Toggle notification">
          <span class="bell-icon">ğŸ””</span>
        </button>

      </div>
      <div class="prayer-item">
        <span class="prayer-name">Asr</span>
        <span class="prayer-time">16:10</span>
        <button class="bell-btn" title="Toggle notification">
          <span class="bell-icon">ğŸ””</span>
        </button>

      </div>
      <div class="prayer-item">
        <span class="prayer-name">Maghrib</span>
        <span class="prayer-time">18:55</span>
        <button class="bell-btn" title="Toggle notification">
          <span class="bell-icon">ğŸ””</span>
        </button>

      </div>
      <div class="prayer-item">
        <span class="prayer-name">Isha</span>
        <span class="prayer-time">20:15</span>
        <button class="bell-btn" title="Toggle notification">
          <span class="bell-icon">ğŸ””</span>
        </button>

      </div>
    </div>

    <!-- Bottom Section -->
    <div class="bottom-section card">
      <button class="thirty-day-btn">30-Day Prayer Times</button>
      <div class="last-third">Last Third of Night: <span id="last-third-time">02:30 - 05:12</span></div>
    </div>
  </div>

  <!-- Donate Section (replaces Mosque) -->
  <!-- Donate Section -->
  <div class="container" id="donate-section" style="display:none">
    <div class="card donate-card" style="text-align:center;">
      <h2 style="font-size:2em;margin-bottom:0.2em;">ğŸ¤² Sadqa-e-Jariya</h2>
      <div id="donate-heart-icon" style="font-size:2.2em;margin-bottom:0.2em;color:#ff6b81;cursor:pointer;">â¤ï¸</div>

      <!-- Trust Message -->
      <!-- Trust Message Trigger -->
      <button id="btn-why-donate"
        style="background:#064e3b; color:#fff; border:1px solid #059669; padding:10px 15px; border-radius:10px; font-size:0.95em; cursor:pointer; width:100%; margin-bottom:15px; font-weight:600;">
        Why Donate? ğŸ’­
      </button>

      <!-- Trust Message Modal -->
      <div id="modal-why-donate" class="modal" style="display:none;">
        <div class="modal-content" style="text-align:left; border:1px solid #059669;">
          <span id="close-why-donate" class="close"
            style="color:#aaa; float:right; font-size:28px; font-weight:bold; cursor:pointer;">&times;</span>
          <div style="font-size:1.1em; color:#fff; font-weight:600; margin-bottom:8px;">Assalamualaikum,</div>
          <div style="font-size:0.95em; color:#ecfdf5; line-height:1.6;">
            Apki di hoi donations haqdaro tk ponchai jay gi... dekhein apkay just 100 se apkay rizq mein kami nahi hogi
            apka ye 100 ak ghareeb ki khoshi ka baais bn sakta hai... <br><br>
            Is dunniya mein hazaro log asay hein jo raat ko bina khai piye so rahay hein hazaro asay hein jo din raat
            allah se dua mangtay hein k allah on k liye koi wasila banay... muj se jitna ho sakta hai mein madad karta
            ho ghareebo ki but agr hum sub mil kr karein to ap khud andaza lagaein k hum kitno ki madad kr sakty
            hein.<br><br>
            Apki di hoi donation mein se ak rupiya bhe mein nahi rakho ga sub donate kia jay ga... and iska proof bhe
            upload hoga just apko dikhanay k liye k apki di hoi donation such mein haqdaaro tk poch rahi... and ap total
            donation bhe dekh sakty hein jo jo user donate kr raha wo live count ho raha takay apko pata chal sakay k
            kitna donate ho raha hai...
          </div>
          <div style="margin-top:10px; font-size:0.85em; color:#6ee7b7; font-weight:700;">
            "Jo shakhs kisi mohtaj ki madad karta hai, Allah uski madad karta hai." (Muslim)
          </div>
        </div>
      </div>

      <!-- Live Global Stats -->
      <div
        style="background:#0f172a; padding:12px; border-radius:12px; margin-bottom:15px; border:1px solid #334155; display:flex; justify-content:space-around;">
        <div>
          <div style="color:#94a3b8; font-size:0.8em;">Total Donations</div>
          <div id="global-donation-total" style="color:#fcd34d; font-size:1.4em; font-weight:700;">0 PKR</div>
        </div>
        <div>
          <div style="color:#94a3b8; font-size:0.8em;">Donors</div>
          <div id="global-donation-count" style="color:#6ee7b7; font-size:1.4em; font-weight:700;">0</div>
        </div>
        <div>
          <div style="color:#94a3b8; font-size:0.8em;">My Streak</div>
          <div id="user-donation-streak" style="color:#ff6b6b; font-size:1.4em; font-weight:700;">0 ğŸ”¥</div>
        </div>
      </div>

      <!-- Payment Method: JazzCash Only -->
      <div class="donate-pay-box"
        style="background:#222c;padding:16px 10px 10px 10px;border-radius:16px;margin-bottom:16px;box-shadow:0 2px 12px #0002;">
        <div id="donate-jazzcash" style="margin-bottom:2px;font-size:1.13em;">
          <b>JazzCash:</b> <span id="jazzcash-number">03284700500</span>
          <button id="copy-jazzcash-btn"
            style="margin-left:6px;padding:2px 10px;border-radius:8px;border:none;background:#6ee7b7;color:#222;cursor:pointer;font-size:0.98em;">Copy</button>
        </div>
        <div style="font-size:0.8em; color:#aaa; margin-top:5px;">Name: Muhammad Hasnain</div>
      </div>

      <!-- Verification Form Trigger -->
      <button id="btn-show-claim-form"
        style="width:100%; border:none; border-radius:12px; background:linear-gradient(135deg, #10b981 0%, #059669 100%); color:#fff; padding:16px; font-weight:700; font-size:1.1em; cursor:pointer; box-shadow:0 6px 20px rgba(16, 185, 129, 0.4); margin-bottom:15px; position:relative; overflow:hidden;">
        I Have Donated âœ…
      </button>

      <!-- Verification Form (Hidden Initially) -->
      <div id="claim-form-container" style="display:none; animation: slideDown 0.3s ease-out; margin-bottom:15px;">
        <label style="font-size:0.9em; color:#cbd5e1;">Enter Transaction ID (from SMS):</label>
        <input type="text" id="donation-trx-id" placeholder="e.g. T2819SH829"
          style="width:100%; padding:10px; margin-top:5px; border-radius:8px; border:1px solid #334155; background:#1e293b; color:#fff; outline:none;">
      </div>

      <button id="donate-submit-btn" class="thirty-day-btn"
        style="margin-bottom:14px;width:100%;background:#6ee7b7;color:#222; font-weight:700;">Submit Claim âœ…</button>

      <div id="user-donation-status" style="margin:10px 0; font-size:0.95em;"></div>
    </div>
  </div>

  <!-- Admin Verification Panel (Hidden by Default) -->
  <div class="container" id="admin-donation-panel" style="display:none; border:2px solid #ef4444;">
    <div class="card">
      <h3 style="color:#ef4444; margin-top:0;">ğŸ›¡ï¸ Admin Verification</h3>
      <div id="admin-pending-list" style="max-height:300px; overflow-y:auto; text-align:left;">
        <!-- Populated by JS -->
        <div style="padding:10px; border-bottom:1px solid #333; color:#aaa;">Loading claims...</div>
      </div>
    </div>
  </div>

  <!-- Quran Audio Section (replaces Qibla) -->
  <div class="container" id="quran-section" style="display:none">
    <div class="card" style="text-align:center;">
      <h2>ğŸ“– Quran Audio</h2>
      <div id="quran-audio-list" style="margin-bottom:18px;"></div>
      <audio id="quran-audio-player" controls style="width:100%;outline:none;">
        <source id="quran-audio-source" src="" type="audio/mp3">
        Your browser does not support the audio element.
      </audio>
      <div id="quran-xp-progress" style="margin-top:12px;font-size:1.08em;color:#6ee7b7;"></div>
    </div>
  </div>

  <!-- Tracker Section -->
  <div class="container" id="tracker-section" style="display:none">
    <!-- Top Level Card -->
    <div class="stat-card-premium tier-1">
      <div class="level-header">
        <div class="level-icon">ğŸ…</div>
        <div class="level-title-row">
          <span class="level-label">Level <span id="level-num">1</span></span>
        </div>
      </div>
      <div class="xp-bar-container-premium">
        <div id="xp-progress" class="xp-bar-fill-premium"></div>
      </div>
      <div class="xp-footer">
        <div style="font-size: 0.85em; color: #fcd34d;">
          ğŸ”¥ <span id="streak-count">0</span> Day Streak
        </div>
        <div id="streak-badges-row" style="margin-top: 5px;"></div>
        <span id="xp-points">0</span> XP
      </div>
    </div>

    <!-- 2-Column Grid -->
    <div class="stats-grid-2col">
      <div class="stat-card-premium mini">
        <div class="mini-header">
          <span class="mini-icon">âš¡</span>
          <span class="mini-label">XP PROGRESS</span>
        </div>
        <div class="mini-desc">Complete prayers to earn XP</div>
        <div class="mini-progress-row">
          <div class="mini-bar-bg">
            <div id="xp-progress-mini" class="mini-bar-fill"></div>
          </div>
          <span class="mini-value-small"><span id="xp-points-mini">0</span> XP</span>
        </div>
      </div>

      <div class="stat-card-premium mini">
        <div class="mini-header">
          <span class="mini-icon">ğŸ</span>
          <span class="mini-label">TOTAL REWARDS</span>
        </div>
        <div class="mini-desc">Equivalent to good deeds performed</div>
        <div class="reward-large-value" id="rewards-points">0</div>
      </div>
    </div>

    <!-- History Card -->
    <div class="stat-card-premium history-card-wrap">
      <div class="history-card-header">
        <div class="history-title-side">
          <span class="history-ico">ğŸ“…</span>
          <span class="history-txt">Prayer History (Last 7 Days)</span>
        </div>
        <div class="history-menu-dots">â€¢â€¢â€¢</div>
      </div>
      <div class="history-table-container">
        <table id="tracker-log-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Tahaj.</th>
              <th>Fajr</th>
              <th>Dhuhr</th>
              <th>Asr</th>
              <th>Magh.</th>
              <th>Isha</th>
            </tr>
          </thead>
          <tbody id="tracker-log-table-body">
            <!-- Filled by JS -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Good Deed Button -->
    <button id="good-deed-btn" class="good-deed-btn-premium">
      <span class="gd-icon">ğŸŒŸ</span> Good Deed Cards
    </button>
  </div>

  <!-- Auth Modal -->
  <div id="auth-modal">
    <div
      style="background:#18243a;padding:32px 24px;border-radius:20px;max-width:340px;width:90vw;box-shadow:0 8px 32px #0008;text-align:center;">
      <h2 id="auth-modal-title">Login</h2>
      <div style="margin-bottom:12px;">
        <input id="auth-email" type="email" placeholder="Email"
          style="width:100%;padding:10px 12px;border-radius:12px;border:none;margin-bottom:10px;font-size:1em;" />
        <input id="auth-password" type="password" placeholder="Password"
          style="width:100%;padding:10px 12px;border-radius:12px;border:none;font-size:1em;" />
      </div>
      <div id="auth-error" style="color:#ff6b6b;font-size:0.98em;height:1.5em;margin-bottom:8px;"></div>
      <button id="auth-submit" class="thirty-day-btn" style="width:100%;margin-bottom:8px;">Login</button>
      <div>
        <span id="auth-switch-text">Don't have an account?</span>
        <button id="auth-switch-btn"
          style="background:none;border:none;color:#6ee7b7;cursor:pointer;font-weight:600;">Sign up</button>
      </div>
    </div>
  </div>

  <!-- Good Deed Card Modal -->
  <div id="good-deed-modal"
    style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);z-index:2001;align-items:center;justify-content:center;">
    <div
      style="background:#18243a;padding:28px 18px 18px 18px;border-radius:20px;max-width:340px;width:90vw;box-shadow:0 8px 32px #0008;text-align:center;position:relative;">
      <button id="good-deed-modal-close"
        style="position:absolute;top:10px;right:14px;background:none;border:none;color:#fff;font-size:1.3em;cursor:pointer;">&times;</button>
      <h3 id="good-deed-card-title" style="margin-bottom:8px;color:#6ee7b7;"></h3>
      <div id="good-deed-card-desc" style="margin-bottom:14px;font-size:1.08em;"></div>
      <button id="good-deed-complete-btn" class="thirty-day-btn" style="margin-bottom:10px;width:100%;">Mark as
        Completed</button>
      <div style="margin:10px 0 6px 0;font-size:0.98em;">Reflection (optional):</div>
      <textarea id="good-deed-reflection" rows="2"
        style="width:100%;border-radius:10px;padding:8px 10px;font-size:1em;"></textarea>
      <button id="good-deed-save-reflection" class="thirty-day-btn"
        style="margin-top:8px;width:100%;background:#6ee7b7;color:#222;">Save Reflection</button>
    </div>
  </div>

  <!-- Notification Popup -->
  <div id="app-notif-modal"
    style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);z-index:2002;align-items:center;justify-content:center;">
    <div
      style="background:#18243a;padding:28px 18px 18px 18px;border-radius:20px;max-width:340px;width:90vw;box-shadow:0 8px 32px #0008;text-align:center;position:relative;">
      <button id="app-notif-close"
        style="position:absolute;top:10px;right:14px;background:none;border:none;color:#fff;font-size:1.3em;cursor:pointer;">&times;</button>
      <h3 id="app-notif-title" style="margin-bottom:8px;color:#6ee7b7;"></h3>
      <div id="app-notif-body" style="margin-bottom:8px;font-size:1.08em;"></div>
    </div>
  </div>

  <!-- More Section (New Features) -->
  <div class="container" id="more-section" style="display:none">

    <!-- Mood-Based Quran (Dil Ki Dawa) - Always Visible at Top -->
    <div class="card" style="text-align:center;margin-bottom:16px;">
      <h2 style="display:flex;align-items:center;gap:8px;justify-content:center;"><span
          style="font-size:1.3em;">ğŸ’–</span> <span>Dil Ki Dawa</span></h2>
      <p style="margin-bottom:12px;color:#a7f3d0;font-size:0.95em;">Aaj aap kaisa feel kar rahe hain?</p>

      <div id="mood-buttons" style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:16px;">
        <button class="thirty-day-btn mood-btn" data-mood="sad" style="background:#334155;">ğŸ˜¢ Sad</button>
        <button class="thirty-day-btn mood-btn" data-mood="anxious" style="background:#334155;">ğŸ˜° Anxious</button>
        <button class="thirty-day-btn mood-btn" data-mood="happy" style="background:#334155;">ğŸ˜Š Happy</button>
        <button class="thirty-day-btn mood-btn" data-mood="angry" style="background:#334155;">ğŸ˜¡ Angry</button>
        <button class="thirty-day-btn mood-btn" data-mood="lazy" style="background:#334155;">ğŸ˜´ Lazy</button>
        <button class="thirty-day-btn mood-btn" data-mood="lonely" style="background:#334155;">ğŸ’” Lonely</button>
      </div>

      <div id="mood-result"
        style="display:none;background:#1a253a;border:1px solid #34d399;border-radius:12px;padding:14px;animation:fadeIn 0.5s;">
        <div id="mood-verse-arabic"
          style="font-size:1.4em;margin-bottom:8px;font-family:'Traditional Arabic', serif;color:#6ee7b7;"></div>
        <div id="mood-verse-urdu" style="font-size:1.05em;margin-bottom:6px;"></div>
        <div id="mood-verse-ref" style="font-size:0.85em;color:#94a3b8;"></div>
      </div>
    </div>

    <!-- Features Menu List -->
    <div id="more-features-menu">
      <div class="card" onclick="openSubFeature('tree')"
        style="display:flex;align-items:center;gap:12px;cursor:pointer;margin-bottom:10px;">
        <div
          style="background:#334155;width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.4em;">
          ğŸŒ³</div>
        <div style="flex:1;text-align:left;">
          <div style="font-weight:600;font-size:1.05em;">Jannat ka Darakht</div>
          <div style="font-size:0.85em;color:#aaa;">Your Deeds Tree</div>
        </div>
        <div style="color:#6ee7b7;">&#8594;</div>
      </div>
      <div class="card" onclick="openSubFeature('twins')"
        style="display:flex;align-items:center;gap:12px;cursor:pointer;margin-bottom:10px;">
        <div
          style="background:#334155;width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.4em;">
          ğŸ¤</div>
        <div style="flex:1;text-align:left;">
          <div style="font-weight:600;font-size:1.05em;">Deen Twins</div>
          <div style="font-size:0.85em;color:#aaa;">Salah Accountability Partner</div>
        </div>
        <div style="color:#6ee7b7;">&#8594;</div>
      </div>
      <div class="card" onclick="openSubFeature('qaza')"
        style="display:flex;align-items:center;gap:12px;cursor:pointer;margin-bottom:10px;">
        <div
          style="background:#334155;width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.4em;">
          ğŸ“…</div>
        <div style="flex:1;text-align:left;">
          <div style="font-weight:600;font-size:1.05em;">Qaza-e-Umri Tracker</div>
          <div style="font-size:0.85em;color:#aaa;">Track your missed prayers</div>
        </div>
        <div style="color:#6ee7b7;">&#8594;</div>
      </div>
      <div class="card" onclick="openSubFeature('halaqa')"
        style="display:flex;align-items:center;gap:12px;cursor:pointer;margin-bottom:10px;">
        <div
          style="background:#334155;width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.4em;">
          ğŸ‘¥</div>
        <div style="flex:1;text-align:left;">
          <div style="font-weight:600;font-size:1.05em;">Halaqa Circles</div>
          <div style="font-size:0.85em;color:#aaa;">Group Accountability & Stats</div>
        </div>
        <div style="color:#6ee7b7;">&#8594;</div>
      </div>
      <div class="card" onclick="openSubFeature('series')"
        style="display:flex;align-items:center;gap:12px;cursor:pointer;margin-bottom:10px;">
        <div
          style="background:#334155;width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.4em;">
          ğŸ“š</div>
        <div style="flex:1;text-align:left;">
          <div style="font-weight:600;font-size:1.05em;">Islamic Series</div>
          <div style="font-size:0.85em;color:#aaa;">Read and learn from series</div>
        </div>
        <div style="color:#6ee7b7;">&#8594;</div>
      </div>
      <div class="card" onclick="openSubFeature('qibla')"
        style="display:flex;align-items:center;gap:12px;cursor:pointer;margin-bottom:10px;">
        <div
          style="background:#334155;width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.4em;">
          ğŸ•‹</div>
        <div style="flex:1;text-align:left;">
          <div style="font-weight:600;font-size:1.05em;">Qibla Finder</div>
          <div style="font-size:0.85em;color:#aaa;">Precise compass to Makkah</div>
        </div>
        <div style="color:#6ee7b7;">&#8594;</div>
      </div>
    </div>

    <!-- Deen Twins (Sub Feature) -->
    <div id="feature-twins" class="sub-feature-view" style="display:none;">
      <div class="card" style="text-align:center;">
        <div style="display:flex;align-items:center;margin-bottom:12px;">
          <button onclick="closeSubFeature()"
            style="background:none;border:none;color:#6ee7b7;font-size:1.2em;cursor:pointer;padding:0 8px 0 0;">&#8592;</button>
          <h2 style="margin:0;font-size:1.3em;">Deen Twins</h2>
        </div>

        <!-- Lobby View -->
        <div id="twins-lobby" style="padding:20px 0;">
          <div style="font-size:4em;margin-bottom:12px;">ğŸ¤</div>
          <p style="font-size:1.1em;margin-bottom:8px;">Find a Prayer Partner</p>
          <p style="color:#94a3b8;font-size:0.9em;margin-bottom:20px;">
            Connect with a random user for a 7-day challenge. Motivate each other to never miss a Salah!
          </p>
          <button id="find-partner-btn" class="thirty-day-btn"
            style="width:100%;background:#6ee7b7;color:#222;font-weight:bold;">Find Partner</button>
          <div id="twins-loading" style="display:none;margin-top:20px;color:#6ee7b7;">
            Searching for partner... â³
          </div>
        </div>

        <!-- Active Pair View -->
        <div id="twins-active" style="display:none;">
          <!-- Partner Profile -->
          <div
            style="background:#334155;border-radius:16px;padding:16px;margin-bottom:16px;display:flex;align-items:center;gap:14px;">
            <div
              style="width:50px;height:50px;background:#1e293b;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.5em;"
              id="partner-avatar">ğŸ‘¤</div>
            <div style="flex:1;text-align:left;">
              <div id="partner-name" style="font-weight:600;font-size:1.1em;color:#fff;">Partner Name</div>
              <div id="partner-status" style="font-size:0.9em;color:#94a3b8;">Status: Waiting...</div>
            </div>
            <button id="twins-nudge-btn"
              style="background:#f59e0b;color:#222;border:none;border-radius:50%;width:40px;height:40px;font-size:1.2em;cursor:pointer;box-shadow:0 4px 12px #f59e0b40;">ğŸ””</button>
          </div>

          <!-- Challenge Progress -->
          <div style="margin-bottom:8px;font-weight:600;text-align:left;">7-Day Streak Challenge</div>
          <div style="height:10px;width:100%;background:#222;border-radius:8px;margin-bottom:20px;overflow:hidden;">
            <div id="twins-progress" style="height:100%;width:14%;background:#6ee7b7;transition:width 0.5s;"></div>
          </div>

          <div style="background:#1e293b;padding:12px;border-radius:12px;">
            <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
              <span>Today's Goal</span>
              <span id="twins-today-status" style="color:#fcd34d;">In Progress</span>
            </div>
            <div style="font-size:0.85em;color:#94a3b8;text-align:left;">
              Both of you must pray all 5 Salahs to complete the day streak.
            </div>
          </div>

          <button id="twins-leave-btn"
            style="margin-top:24px;background:none;border:none;color:#ff6b6b;text-decoration:underline;cursor:pointer;font-size:0.9em;">Leave
            Challenge</button>
        </div>

      </div>
    </div>
    <!-- Jannat ka Darakht (Sub Feature) -->
    <div id="feature-tree" class="sub-feature-view" style="display:none;">
      <div class="card" style="text-align:center;">
        <div style="display:flex;align-items:center;margin-bottom:4px;">
          <button onclick="closeSubFeature()"
            style="background:none;border:none;color:#6ee7b7;font-size:1.2em;cursor:pointer;padding:0 8px 0 0;">&#8592;</button>
          <h2 style="margin:0;font-size:1.3em;">Jannat ka Darakht</h2>
        </div>
        <p style="margin-bottom:16px;color:#94a3b8;font-size:0.9em;">Aapke aamaal se ye darakht badhta hai.</p>

        <!-- Tree Visualization -->
        <div
          style="position:relative;width:100%;height:300px;background:linear-gradient(to bottom, #1e293b, #0f172a);border-radius:16px;overflow:hidden;margin-bottom:12px;box-shadow:inset 0 0 20px #0008;">
          <!-- Sun/Moon -->
          <div id="tree-sky-orb"
            style="position:absolute;top:20px;right:20px;width:40px;height:40px;background:#fbbf24;border-radius:50%;box-shadow:0 0 15px #fbbf24;">
          </div>

          <!-- Tree SVG -->
          <svg id="tree-svg" width="100%" height="100%" viewBox="0 0 200 300" preserveAspectRatio="xMidYMax">
            <!-- Ground -->
            <path d="M0,280 Q100,260 200,280 L200,300 L0,300 Z" fill="#3f6212" />
            <!-- Trunk -->
            <path id="tree-trunk" d="M95,280 Q90,200 95,150 Q100,200 105,280" fill="#78350f" stroke="#78350f"
              stroke-width="2" />
            <!-- Branches (Hidden/Shown based on health) -->
            <g id="tree-branches" stroke="#78350f" stroke-width="2" fill="none" style="display:none;">
              <path d="M95,180 Q60,140 50,100" />
              <path d="M105,180 Q140,140 150,100" />
              <path d="M95,150 Q70,110 80,80" />
              <path d="M105,150 Q130,110 120,80" />
            </g>
            <!-- Leaves Group -->
            <g id="tree-leaves"></g>
          </svg>

          <!-- Health Text Overlay -->
          <div id="tree-health-text"
            style="position:absolute;bottom:10px;left:0;width:100%;text-align:center;color:#fff;text-shadow:0 1px 4px #000;font-weight:600;font-size:0.9em;">
            Health: 50%
          </div>
        </div>

        <div id="tree-status-msg" style="font-size:1.05em;color:#6ee7b7;margin-bottom:8px;"></div>
        <div style="font-size:0.85em;color:#94a3b8;line-height:1.4;">
          Rule: Namaz (+), Good Deeds (+)<br>Missed Namaz (---) damages the tree.
        </div>
      </div>
    </div>

    <!-- Qaza-e-Umri Tracker (Sub Feature) -->
    <div id="feature-qaza" class="sub-feature-view" style="display:none;">
      <div class="card" style="text-align:center;">
        <div style="display:flex;align-items:center;margin-bottom:16px;">
          <button onclick="closeSubFeature()"
            style="background:none;border:none;color:#6ee7b7;font-size:1.2em;cursor:pointer;padding:0 8px 0 0;">&#8592;</button>
          <h2 style="margin:0;font-size:1.3em;">Qaza Tracker</h2>
        </div>

        <!-- Setup View -->
        <div id="qaza-setup-view">
          <p style="margin-bottom:12px;color:#a7f3d0;font-size:0.95em;">Calculate your missed prayers estimate.</p>
          <div style="margin-bottom:12px;text-align:left;">
            <label style="display:block;margin-bottom:4px;font-size:0.9em;">Total Years Missed (approx):</label>
            <input type="number" id="qaza-years-input" placeholder="e.g. 5"
              style="width:100%;padding:10px;border-radius:10px;border:none;background:#334155;color:#fff;font-size:1em;">
          </div>
          <button id="qaza-calc-btn" class="thirty-day-btn" style="width:100%;background:#6ee7b7;color:#222;">Calculate
            & Start Tracking</button>
        </div>

        <!-- Tracker View -->
        <div id="qaza-tracker-view" style="display:none;">
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px;">
            <!-- Prayer Counters -->
            <div class="qaza-card" style="background:#334155;padding:10px;border-radius:12px;">
              <div style="font-weight:600;margin-bottom:4px;">Fajr</div>
              <div class="qaza-count" id="qaza-count-fajr" style="font-size:1.2em;color:#6ee7b7;">0</div>
              <button class="qaza-minus-btn" data-prayer="Fajr"
                style="margin-top:4px;padding:4px 8px;border-radius:6px;border:none;background:#6ee7b7;color:#222;cursor:pointer;font-size:0.85em;">Prayed
                1</button>
            </div>
            <div class="qaza-card" style="background:#334155;padding:10px;border-radius:12px;">
              <div style="font-weight:600;margin-bottom:4px;">Dhuhr</div>
              <div class="qaza-count" id="qaza-count-dhuhr" style="font-size:1.2em;color:#6ee7b7;">0</div>
              <button class="qaza-minus-btn" data-prayer="Dhuhr"
                style="margin-top:4px;padding:4px 8px;border-radius:6px;border:none;background:#6ee7b7;color:#222;cursor:pointer;font-size:0.85em;">Prayed
                1</button>
            </div>
            <div class="qaza-card" style="background:#334155;padding:10px;border-radius:12px;">
              <div style="font-weight:600;margin-bottom:4px;">Asr</div>
              <div class="qaza-count" id="qaza-count-asr" style="font-size:1.2em;color:#6ee7b7;">0</div>
              <button class="qaza-minus-btn" data-prayer="Asr"
                style="margin-top:4px;padding:4px 8px;border-radius:6px;border:none;background:#6ee7b7;color:#222;cursor:pointer;font-size:0.85em;">Prayed
                1</button>
            </div>
            <div class="qaza-card" style="background:#334155;padding:10px;border-radius:12px;">
              <div style="font-weight:600;margin-bottom:4px;">Maghrib</div>
              <div class="qaza-count" id="qaza-count-maghrib" style="font-size:1.2em;color:#6ee7b7;">0</div>
              <button class="qaza-minus-btn" data-prayer="Maghrib"
                style="margin-top:4px;padding:4px 8px;border-radius:6px;border:none;background:#6ee7b7;color:#222;cursor:pointer;font-size:0.85em;">Prayed
                1</button>
            </div>
            <div class="qaza-card" style="background:#334155;padding:10px;border-radius:12px;">
              <div style="font-weight:600;margin-bottom:4px;">Isha</div>
              <div class="qaza-count" id="qaza-count-isha" style="font-size:1.2em;color:#6ee7b7;">0</div>
              <button class="qaza-minus-btn" data-prayer="Isha"
                style="margin-top:4px;padding:4px 8px;border-radius:6px;border:none;background:#6ee7b7;color:#222;cursor:pointer;font-size:0.85em;">Prayed
                1</button>
            </div>
            <div class="qaza-card" style="background:#334155;padding:10px;border-radius:12px;">
              <div style="font-weight:600;margin-bottom:4px;">Witr</div>
              <div class="qaza-count" id="qaza-count-witr" style="font-size:1.2em;color:#6ee7b7;">0</div>
              <button class="qaza-minus-btn" data-prayer="Witr"
                style="margin-top:4px;padding:4px 8px;border-radius:6px;border:none;background:#6ee7b7;color:#222;cursor:pointer;font-size:0.85em;">Prayed
                1</button>
            </div>
          </div>
          <button id="qaza-reset-btn"
            style="margin-top:16px;background:none;border:none;color:#ff6b6b;text-decoration:underline;cursor:pointer;font-size:0.9em;">Reset
            Counters</button>
        </div>
      </div>
    </div>

    <!-- Islamic Series (Sub Feature) -->
    <div id="feature-series" class="sub-feature-view" style="display:none;">
      <div class="card" style="text-align:center; min-height: 400px; display: flex; flex-direction: column;">
        <div style="display:flex;align-items:center;margin-bottom:16px;">
          <button id="series-back-btn"
            style="background:none;border:none;color:#6ee7b7;font-size:1.2em;cursor:pointer;padding: 0 12px 0 0;">&#8592;</button>
          <h2 id="series-header-title" style="margin:0;font-size:1.3em;">Islamic Series</h2>
        </div>

        <!-- Series List View -->
        <div id="series-list-view" style="flex: 1; overflow-y: auto;">
          <!-- Series cards will be injected here -->
        </div>

        <!-- Episode List View -->
        <div id="episode-list-view" style="display:none; flex: 1; overflow-y: auto;">
          <!-- Episode cards will be injected here -->
        </div>

        <!-- Article View -->
        <div id="article-view" style="display:none; flex: 1; overflow-y: auto; text-align: left;">
          <h3 id="article-title" style="color: #6ee7b7; margin-bottom: 12px; font-size: 1.2em;"></h3>
          <div id="article-content"
            style="line-height: 1.6; color: #e2e8f0; font-size: 1.05em; white-space: pre-wrap; padding-bottom: 20px;">
            <!-- Article text will be injected here -->
          </div>
        </div>
      </div>
    </div>

    <!-- Halaqa Feature View -->
    <div id="feature-halaqa" class="sub-feature-view" style="display:none; animation: slideUp 0.3s ease-out;">
      <div class="card" style="text-align:center;">
        <div style="display:flex;align-items:center;margin-bottom:12px;">
          <button onclick="closeSubFeature()"
            style="background:none;border:none;color:#6ee7b7;font-size:1.2em;cursor:pointer;padding:0 8px 0 0;">&#8592;</button>
          <h2 style="margin:0;font-size:1.3em;">Halaqa Circles ğŸ‘¥</h2>
        </div>

        <!-- Lobby: Join or Create -->
        <div id="halaqa-lobby" style="text-align:center;">
          <p style="color:#94a3b8;font-size:0.95em;margin-bottom:20px;">
            Form a circle with friends/family. Compete in good deeds and keep each other steadfast!
          </p>

          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
            <button id="halaqa-create-btn" class="thirty-day-btn"
              style="background:#6ee7b7;color:#0f172a;font-weight:600;">
              Create Circle
            </button>
            <button id="halaqa-join-btn" class="thirty-day-btn" style="background:#334155;color:#fff;">
              Join Circle
            </button>
          </div>

          <!-- Join Input (Hidden initially) -->
          <div id="halaqa-join-input-container" style="display:none;margin-top:16px;">
            <input type="text" id="halaqa-code-input" placeholder="Enter 6-digit Code"
              style="width:100%;padding:12px;border-radius:12px;border:none;background:#0f172a;color:#fff;text-align:center;letter-spacing:2px;font-size:1.1em;margin-bottom:8px;">
            <button id="halaqa-submit-join" class="thirty-day-btn" style="width:100%;">Enter Circle</button>
          </div>
        </div>

        <!-- Active Circle View -->
        <div id="halaqa-active" style="display:none;">

          <!-- Header Card -->
          <div class="card"
            style="margin-bottom:16px;background:linear-gradient(135deg,#1e293b,#0f172a);border:1px solid #334155;">
            <div style="display:flex;justify-content:space-between;align-items:start;">
              <div>
                <div id="halaqa-name" style="font-size:1.3em;font-weight:700;color:#fff;margin-bottom:4px;">--</div>
                <div style="font-size:0.85em;color:#94a3b8;display:flex;align-items:center;gap:6px;">
                  Code: <span id="halaqa-code-display"
                    style="font-family:monospace;background:#334155;padding:2px 6px;border-radius:4px;color:#cbd5e1;cursor:pointer;">------</span>
                  <span style="font-size:0.8em;opacity:0.7;">(Tap to copy)</span>
                </div>
              </div>
              <div id="halaqa-member-count"
                style="background:#334155;padding:4px 10px;border-radius:20px;font-size:0.85em;">0 Members</div>
            </div>
            <button id="halaqa-leave-btn"
              style="margin-top:12px;font-size:0.85em;color:#ff6b6b;background:none;border:none;cursor:pointer;text-decoration:underline;">Leave
              Circle</button>
          </div>

          <h3 style="margin:0 0 10px 4px;font-size:1.1em;color:#e2e8f0;">Leaderboard (This Week)</h3>
          <div id="halaqa-leaderboard" style="display:flex;flex-direction:column;gap:10px;">
            <!-- Leaderboard Items Injected Here -->
          </div>

          <!-- Chat Section -->
          <h3 style="margin:20px 0 10px 4px;font-size:1.1em;color:#e2e8f0;">Group Chat ğŸ’¬</h3>
          <div id="halaqa-chat-container" class="card"
            style="padding:0;background:#1e293b;height:300px;display:flex;flex-direction:column;border:1px solid #334155;">
            <div id="halaqa-chat-messages"
              style="flex:1;overflow-y:auto;padding:12px;display:flex;flex-direction:column;gap:8px;">
              <div style="text-align:center;color:#64748b;font-size:0.9em;margin-top:20px;">No messages yet. Say Salam!
                ğŸ‘‹</div>
            </div>
            <div
              style="padding:10px;background:#0f172a;display:flex;gap:8px;border-top:1px solid #334155;border-radius:0 0 12px 12px;">
              <input type="text" id="halaqa-chat-input" placeholder="Type a message..."
                style="flex:1;background:#334155;color:#fff;border:none;padding:10px;border-radius:20px;outline:none;">
              <button id="halaqa-chat-send-btn"
                style="background:#6ee7b7;color:#0f172a;border:none;border-radius:50%;width:40px;height:40px;cursor:pointer;font-weight:bold;">â¤</button>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- Bottom Navigation -->
  <nav class="bottom-nav">
    <button class="nav-btn"><span class="nav-icon">ğŸ </span></button>
    <button class="nav-btn"><span class="nav-icon">ğŸ¤²</span></button>
    <button class="nav-btn"><span class="nav-icon">ğŸ“–</span></button>
    <button class="nav-btn"><span class="nav-icon">ğŸ“Š</span></button>
    <button class="nav-btn"><span class="nav-icon">â˜°</span></button>
  </nav>

  <!-- Modals & Sub Features -->
  <div id="modal-partner-invite" class="modal">
    <div class="modal-content" style="text-align:center;">
      <div style="font-size:3em;margin-bottom:10px;">ğŸ¤</div>
      <h2 style="margin-top:0;">Find Your Salah Partner</h2>
      <p style="color:#94a3b8;">Boost your motivation by pairing with a partner! Track prayers together.</p>
      <button id="btn-modal-find-partner" class="thirty-day-btn" style="width:100%;margin-bottom:10px;">Find Partner
        Now</button>
      <button id="btn-modal-not-now"
        style="background:none;border:none;color:#aaa;text-decoration:underline;cursor:pointer;">Not now</button>
    </div>
  </div>

  <!-- Qibla Finder (Sub Feature) -->
  <div id="feature-qibla" class="sub-feature-view" style="display:none;">
    <div class="card" style="text-align:center; padding: 25px 15px;">
      <div style="display:flex;align-items:center;margin-bottom:20px;">
        <button onclick="closeSubFeature()"
          style="background:none;border:none;color:#6ee7b7;font-size:1.2em;cursor:pointer;padding:0 8px 0 0;">&#8592;</button>
        <h2 style="margin:0;font-size:1.3em;">Qibla Finder</h2>
      </div>

      <div id="qibla-compass-container" style="position:relative; width:280px; height:280px; margin: 0 auto 30px auto;">
        <!-- Outer Ring -->
        <div
          style="position:absolute; top:0; left:0; width:100%; height:100%; border: 4px solid #334155; border-radius: 50%; box-sizing: border-box;">
        </div>
        <!-- Compass Disk -->
        <div id="qibla-disk"
          style="position:absolute; top:10px; left:10px; width:260px; height:260px; transition: transform 0.2s ease-out; transform-style: preserve-3d;">
          <!-- Degree Marks -->
          <div id="qibla-degrees" style="position:absolute; width:100%; height:100%; font-size: 0.7em; color: #94a3b8;">
            <span
              style="position:absolute; top:5px; left:50%; transform:translateX(-50%); font-weight:bold; color:#ff6b6b;">N</span>
            <span style="position:absolute; bottom:5px; left:50%; transform:translateX(-50%);">S</span>
            <span style="position:absolute; top:50%; left:5px; transform:translateY(-50%);">W</span>
            <span style="position:absolute; top:50%; right:5px; transform:translateY(-50%);">E</span>
          </div>
          <!-- Kaaba Pointer Icon inside disk -->
          <div id="kaaba-pointer"
            style="position:absolute; top:5px; left:50%; transform:translateX(-50%); transform-origin: 50% 125px; font-size: 2em; z-index: 10; filter: drop-shadow(0 0 5px #fcd34d); transition: color 0.3s, filter 0.3s;">
            ğŸ•‹</div>
        </div>
        <!-- Fixed Indicator (User's Phone Heading) -->
        <div
          style="position:absolute; top:-15px; left:50%; transform:translateX(-50%); width:0; height:0; border-left: 10px solid transparent; border-right: 10px solid transparent; border-bottom: 20px solid #6ee7b7; z-index: 20;">
        </div>
      </div>

      <div id="qibla-status-card"
        style="background:#1e293b; border-radius:15px; padding:15px; border: 1px solid #334155;">
        <div id="qibla-bearing-text" style="font-size:1.1em; color:#fff; font-weight:600; margin-bottom:5px;">Finding
          location...</div>
        <div id="qibla-dist-text" style="font-size:0.9em; color:#94a3b8;">-- km from Makkah</div>
        <div id="qibla-accuracy-warning" style="display:none; color:#f59e0b; font-size:0.8em; margin-top:8px;">âš ï¸ Please
          calibrate your compass</div>
      </div>

      <!-- Permission Prompt -->
      <button id="qibla-permission-btn" style="display:none; margin-top:20px; width:100%;" class="thirty-day-btn">Enable
        Compass</button>
    </div>
  </div>

  <div id="toast-popup"></div>
  <!-- ==================== ONBOARDING WIZARD ==================== -->
  <style>
    .onboarding-step {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      width: 100%;
      height: 100%;
      padding: 24px;
      box-sizing: border-box;
      animation: fadeIn 0.4s ease;
    }

    .onboarding-emoji {
      font-size: 4em;
      margin-bottom: 20px;
      animation: bounce 2s infinite;
    }

    .onboarding-title {
      font-size: 1.8em;
      font-weight: 800;
      color: #fcd34d;
      margin-bottom: 12px;
    }

    .onboarding-text {
      font-size: 1.1em;
      color: #cbd5e1;
      margin-bottom: 30px;
      line-height: 1.6;
      max-width: 400px;
    }

    .onboarding-btn {
      background: #6ee7b7;
      color: #0f172a;
      border: none;
      padding: 14px 40px;
      font-size: 1.1em;
      font-weight: 700;
      border-radius: 50px;
      cursor: pointer;
      transition: transform 0.2s;
      box-shadow: 0 4px 15px rgba(110, 231, 183, 0.4);
    }

    .onboarding-btn:active {
      transform: scale(0.95);
    }

    .onboarding-input-group {
      margin-bottom: 20px;
      text-align: left;
      width: 100%;
      max-width: 320px;
    }

    .onboarding-label {
      display: block;
      margin-bottom: 8px;
      color: #94a3b8;
      font-size: 0.9em;
      font-weight: 600;
    }

    .onboarding-select,
    .onboarding-time {
      width: 100%;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid #334155;
      background: #1e293b;
      color: #f8fafc;
      font-size: 1.1em;
      outline: none;
    }

    @keyframes bounce {

      0%,
      100% {
        transform: translateY(0);
      }

      50% {
        transform: translateY(-10px);
      }
    }
  </style>

  <div id="onboarding-modal"
    style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; z-index:99999; background:#0f172a;">

    <!-- Step 1: Welcome & Permissions -->
    <div id="onboarding-step-1" class="onboarding-step" style="display:flex;">
      <div class="onboarding-emoji">ğŸ‘‹</div>
      <div class="onboarding-title">Welcome to Salah Tracker</div>
      <div class="onboarding-text">
        Assalam-o-Alaikum! <br>
        Is app ka maqsad aapko Allah ke qareeb karna hai. <br><br>
        Sab se pehle, notifications allow karen taake aap koi namaz miss na karen aur hum aapko waqt par yaad dila
        saken.
      </div>
      <button class="onboarding-btn" id="btn-onboarding-permit">Enable Notifications ğŸ””</button>
      <div style="margin-top:10px; font-size:0.8em; color:#64748b;">(Required to proceed)</div>
    </div>

    <!-- Step 2: Personalization -->
    <div id="onboarding-step-2" class="onboarding-step">
      <div class="onboarding-emoji">ğŸŒ™</div>
      <div class="onboarding-title">Thora aap ke baray mein</div>
      <div class="onboarding-text" style="font-size:1em; margin-bottom:20px;">
        Taake hum app ko aap ke mutabiq dhaal saken.
      </div>

      <div class="onboarding-input-group">
        <label class="onboarding-label">Aap raat ko kitnay bajay sotay hain?</label>
        <input type="time" id="input-sleep-time" class="onboarding-time" value="23:00">
        <div style="font-size:0.75em; color:#64748b; margin-top:4px;">Hum usi waqt aapko sone se pehle Quran sunnay ka
          reminder denge. ğŸ§</div>
      </div>

      <div class="onboarding-input-group">
        <label class="onboarding-label">Sab se zyada kaunsi namaz miss hoti hai?</label>
        <select id="input-struggle-prayer" class="onboarding-select">
          <option value="Fajr">Fajr (Subah)</option>
          <option value="Dhuhr">Dhuhr (Dopehar)</option>
          <option value="Asr">Asr (Sham)</option>
          <option value="Maghrib">Maghrib (Suraj dubne par)</option>
          <option value="Isha">Isha (Raat)</option>
        </select>
        <div style="font-size:0.75em; color:#64748b; margin-top:4px;">Hum is namaz par zyada focus karenge. ğŸ’ª</div>
      </div>

      <button class="onboarding-btn" id="btn-onboarding-next-2" style="background:#fcd34d; color:#0f172a;">Next
        âœ</button>
    </div>

    <!-- Step 3: Developer Mission -->
    <div id="onboarding-step-3" class="onboarding-step">
      <div class="onboarding-emoji">ğŸ‘¨â€ğŸ’»</div>
      <div class="onboarding-title">Meri Kahani</div>
      <div class="onboarding-text" style="text-align:left; max-width:85%;">
        Mera naam <b>Hasnain</b> hai. <br><br>
        Maine ye app paisa kamanay ke liye nahi banayi. <br>
        Mera maqsad sirf ye hai ke jadeed technology (AI & Code) ka istemal kar ke hum Musalmano ko Allah ke aur qareeb
        kar saken. <br><br>
        Main akela is app par mahino se kaam kar raha hoon. Agar kahin koi issue nazar aaye to maafi chahta hoon, main
        usay fix kar raha hoon. <br><br>
        <div style="text-align:center; font-weight:700; color:#6ee7b7;">JazakAllah Khair!</div>
      </div>
      <button class="onboarding-btn" id="btn-onboarding-finish">Get Started ğŸš€</button>
    </div>

  </div>
  <script type="module" src="app.js?v=3.7"></script>
  <script type="module" src="app2.js?v=1.0"></script>
</body>

</html>
